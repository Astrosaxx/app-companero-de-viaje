{% extends 'base.html' %}
{% block title %}Panel de viajes{% endblock %}
{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-0">Hola, {{ usuario.nombre }} üëã</h2>
    <p class="text-muted">Organiza y √∫nete a traves√≠as con tus amigos</p>
  </div>
  <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalCrear">Crear viaje</button>
</div>

<!-- Estad√≠sticas -->
<div class="row g-3 mb-4 fade-in-up">
  <div class="col-md-3">
    <div class="stats-card">
      <div class="stats-number text-primary">{{ viajes_creados_por_usuario|length }}</div>
      <div class="stats-label">Viajes creados</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <div class="stats-number text-success">{{ viajes_unidos|length }}</div>
      <div class="stats-label">Viajes unidos</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <div class="stats-number text-info">{{ viajes_disponibles|length }}</div>
      <div class="stats-label">Viajes disponibles</div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="stats-card">
      <div class="stats-number text-warning">{{ (viajes_creados_por_usuario|length + viajes_unidos|length) }}</div>
      <div class="stats-label">Total participando</div>
    </div>
  </div>
</div>

<div class="row g-4 tab-content">
  <div class="col-12 col-lg-6">
    <div class="card glass-card">
      <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
        <strong><i class="fas fa-calendar-alt me-2"></i>Tu agenda de viajes</strong>
        <span class="badge text-bg-primary">{{ (viajes_creados_por_usuario|length + viajes_unidos|length) }} viajes</span>
      </div>
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>Destino</th>
              <th>Desde</th>
              <th>Hasta</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for v in viajes_creados_por_usuario %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <i class="fas fa-map-marker-alt text-primary"></i>
                  </div>
                  <div>
                    <a href="/travels/detalle/{{ v.id }}" class="link-table fw-bold">{{ v.titulo }}</a>
                    <div class="small text-muted">{{ v.descripcion[:40] }}{% if v.descripcion|length > 40 %}...{% endif %}</div>
                    <span class="badge text-bg-secondary mt-1">Creado por ti</span>
                  </div>
                </div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_inicio|format_date }}</div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_fin|format_date }}</div>
              </td>
              <td class="text-end">
                <div class="table-buttons">
                  <a href="/travels/detalle/{{ v.id }}" class="btn btn-sm btn-outline-info">
                    <i class="fas fa-eye me-1"></i>
                    <span class="d-none d-sm-inline">Ver</span>
                  </a>
                  <form action="/travels/validar_edicion" method="POST" class="d-inline">
                    <input type="hidden" name="viaje_id" value="{{ v.id }}" />
                    <button class="btn btn-sm btn-outline-primary">
                      <i class="fas fa-edit me-1"></i>
                      <span class="d-none d-sm-inline">Editar</span>
                    </button>
                  </form>
                  <form action="/travels/eliminar/{{ v.id }}" method="POST" class="d-inline" onsubmit="return confirm('¬øEliminar viaje?');">
                    <button class="btn btn-sm btn-outline-danger">
                      <i class="fas fa-trash me-1"></i>
                      <span class="d-none d-sm-inline">Eliminar</span>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
            {% for v in viajes_unidos %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <i class="fas fa-users text-success"></i>
                  </div>
                  <div>
                    <a href="/travels/detalle/{{ v.id }}" class="link-table fw-bold">{{ v.titulo }}</a>
                    <div class="small text-muted">{{ v.descripcion[:40] }}{% if v.descripcion|length > 40 %}...{% endif %}</div>
                    <span class="badge text-bg-success mt-1">Unido</span>
                  </div>
                </div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_inicio|format_date }}</div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_fin|format_date }}</div>
              </td>
              <td class="text-end">
                <div class="table-buttons">
                  <a href="/travels/detalle/{{ v.id }}" class="btn btn-sm btn-outline-info">
                    <i class="fas fa-eye me-1"></i>
                    <span class="d-none d-sm-inline">Ver</span>
                  </a>
                  <form action="/travels/salir/{{ v.id }}" method="POST" class="d-inline" onsubmit="return confirm('¬øCancelar asistencia?');">
                    <button class="btn btn-sm btn-outline-warning">
                      <i class="fas fa-sign-out-alt me-1"></i>
                      <span class="d-none d-sm-inline">Salir</span>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
            {% if not viajes_creados_por_usuario and not viajes_unidos %}
            <tr>
              <td colspan="4" class="text-center text-muted">A√∫n no tienes viajes programados.</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="col-12 col-lg-6">
    <div class="card glass-card">
      <div class="card-header bg-transparent d-flex justify-content-between align-items-center">
        <strong><i class="fas fa-globe me-2"></i>Viajes de otros usuarios</strong>
        <span class="badge text-bg-info">{{ viajes_disponibles|length }} disponibles</span>
      </div>
      <div class="table-responsive">
        <table class="table align-middle mb-0">
          <thead>
            <tr>
              <th>Destino</th>
              <th>Desde</th>
              <th>Hasta</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% for v in viajes_disponibles %}
            <tr>
              <td>
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <i class="fas fa-plane text-info"></i>
                  </div>
                  <div>
                    <a href="/travels/detalle/{{ v.id }}" class="link-table fw-bold">{{ v.titulo }}</a>
                    <div class="small text-muted">{{ v.descripcion[:40] }}{% if v.descripcion|length > 40 %}...{% endif %}</div>
                    <span class="badge text-bg-info mt-1">Disponible</span>
                  </div>
                </div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_inicio|format_date }}</div>
              </td>
              <td>
                <div class="small text-muted">{{ v.fecha_fin|format_date }}</div>
              </td>
              <td class="text-end">
                <div class="table-buttons">
                  <a href="/travels/detalle/{{ v.id }}" class="btn btn-sm btn-outline-primary">
                    <i class="fas fa-eye me-1"></i>
                    <span class="d-none d-sm-inline">Ver</span>
                  </a>
                  <form action="/travels/unir/{{ v.id }}" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-success">
                      <i class="fas fa-plus me-1"></i>
                      <span class="d-none d-sm-inline">Unirme</span>
                    </button>
                  </form>
                </div>
              </td>
            </tr>
            {% endfor %}
            {% if not viajes_disponibles %}
            <tr>
              <td colspan="4" class="text-center text-muted">No hay viajes disponibles por ahora.</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal crear viaje -->
<div class="modal fade" id="modalCrear" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form action="/travels/crear" method="POST">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            <i class="fas fa-plus-circle me-2"></i>Crear nuevo viaje
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-12">
              <label class="form-label fw-bold">
                <i class="fas fa-map-marker-alt me-1"></i>Destino del viaje
              </label>
              <input type="text" name="titulo" class="form-control" placeholder="Ej: Viaje a Par√≠s" required minlength="3" />
              <div class="form-text">El t√≠tulo debe tener al menos 3 caracteres</div>
            </div>
            <div class="col-12">
              <label class="form-label fw-bold">
                <i class="fas fa-align-left me-1"></i>Descripci√≥n
              </label>
              <textarea name="descripcion" class="form-control" rows="4" placeholder="Describe los detalles del viaje, actividades planificadas, etc." required minlength="10"></textarea>
              <div class="form-text">La descripci√≥n debe tener al menos 10 caracteres</div>
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">
                <i class="fas fa-calendar-day me-1"></i>Fecha de inicio
              </label>
              <input type="date" name="fecha_inicio" class="form-control" required />
            </div>
            <div class="col-md-6">
              <label class="form-label fw-bold">
                <i class="fas fa-calendar-check me-1"></i>Fecha de fin
              </label>
              <input type="date" name="fecha_fin" class="form-control" required />
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>Cancelar
          </button>
          <button class="btn btn-primary">
            <i class="fas fa-save me-1"></i>Crear viaje
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

{% endblock %}

